{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\nvar vue = require('vue');\nrequire('../../../utils/index.js');\nrequire('./composables/index.js');\nvar useColumns = require('./composables/use-columns.js');\nvar useScrollbar = require('./composables/use-scrollbar.js');\nvar useRow = require('./composables/use-row.js');\nvar useData = require('./composables/use-data.js');\nvar useStyles = require('./composables/use-styles.js');\nvar shared = require('@vue/shared');\nfunction useTable(props) {\n  const mainTableRef = vue.ref();\n  const leftTableRef = vue.ref();\n  const rightTableRef = vue.ref();\n  const {\n    columns,\n    columnsStyles,\n    columnsTotalWidth,\n    fixedColumnsOnLeft,\n    fixedColumnsOnRight,\n    hasFixedColumns,\n    mainColumns,\n    onColumnSorted\n  } = useColumns.useColumns(props, vue.toRef(props, \"columns\"), vue.toRef(props, \"fixed\"));\n  const {\n    scrollTo,\n    scrollToLeft,\n    scrollToTop,\n    scrollToRow,\n    onScroll,\n    onVerticalScroll,\n    scrollPos\n  } = useScrollbar.useScrollbar(props, {\n    mainTableRef,\n    leftTableRef,\n    rightTableRef,\n    onMaybeEndReached\n  });\n  const {\n    expandedRowKeys,\n    hoveringRowKey,\n    lastRenderedRowIndex,\n    isDynamic,\n    isResetting,\n    rowHeights,\n    resetAfterIndex,\n    onRowExpanded,\n    onRowHeightChange,\n    onRowHovered,\n    onRowsRendered\n  } = useRow.useRow(props, {\n    mainTableRef,\n    leftTableRef,\n    rightTableRef\n  });\n  const {\n    data,\n    depthMap\n  } = useData.useData(props, {\n    expandedRowKeys,\n    lastRenderedRowIndex,\n    resetAfterIndex\n  });\n  const {\n    bodyWidth,\n    fixedTableHeight,\n    mainTableHeight,\n    leftTableWidth,\n    rightTableWidth,\n    headerWidth,\n    rowsHeight,\n    windowHeight,\n    footerHeight,\n    emptyStyle,\n    rootStyle,\n    headerHeight\n  } = useStyles.useStyles(props, {\n    columnsTotalWidth,\n    data,\n    fixedColumnsOnLeft,\n    fixedColumnsOnRight\n  });\n  const isScrolling = vue.shallowRef(false);\n  const containerRef = vue.ref();\n  const showEmpty = vue.computed(() => {\n    const noData = vue.unref(data).length === 0;\n    return shared.isArray(props.fixedData) ? props.fixedData.length === 0 && noData : noData;\n  });\n  function getRowHeight(rowIndex) {\n    const {\n      estimatedRowHeight,\n      rowHeight,\n      rowKey\n    } = props;\n    if (!estimatedRowHeight) return rowHeight;\n    return vue.unref(rowHeights)[vue.unref(data)[rowIndex][rowKey]] || estimatedRowHeight;\n  }\n  function onMaybeEndReached() {\n    const {\n      onEndReached\n    } = props;\n    if (!onEndReached) return;\n    const {\n      scrollTop\n    } = vue.unref(scrollPos);\n    const _totalHeight = vue.unref(rowsHeight);\n    const clientHeight = vue.unref(windowHeight);\n    const heightUntilEnd = _totalHeight - (scrollTop + clientHeight) + props.hScrollbarSize;\n    if (vue.unref(lastRenderedRowIndex) >= 0 && _totalHeight === scrollTop + vue.unref(mainTableHeight) - vue.unref(headerHeight)) {\n      onEndReached(heightUntilEnd);\n    }\n  }\n  vue.watch(() => props.expandedRowKeys, val => expandedRowKeys.value = val, {\n    deep: true\n  });\n  return {\n    columns,\n    containerRef,\n    mainTableRef,\n    leftTableRef,\n    rightTableRef,\n    isDynamic,\n    isResetting,\n    isScrolling,\n    hoveringRowKey,\n    hasFixedColumns,\n    columnsStyles,\n    columnsTotalWidth,\n    data,\n    expandedRowKeys,\n    depthMap,\n    fixedColumnsOnLeft,\n    fixedColumnsOnRight,\n    mainColumns,\n    bodyWidth,\n    emptyStyle,\n    rootStyle,\n    headerWidth,\n    footerHeight,\n    mainTableHeight,\n    fixedTableHeight,\n    leftTableWidth,\n    rightTableWidth,\n    showEmpty,\n    getRowHeight,\n    onColumnSorted,\n    onRowHovered,\n    onRowExpanded,\n    onRowsRendered,\n    onRowHeightChange,\n    scrollTo,\n    scrollToLeft,\n    scrollToTop,\n    scrollToRow,\n    onScroll,\n    onVerticalScroll\n  };\n}\nexports.useTable = useTable;","map":{"version":3,"names":["useTable","props","mainTableRef","vue","ref","leftTableRef","rightTableRef","columns","columnsStyles","columnsTotalWidth","fixedColumnsOnLeft","fixedColumnsOnRight","hasFixedColumns","mainColumns","onColumnSorted","useColumns","toRef","scrollTo","scrollToLeft","scrollToTop","scrollToRow","onScroll","onVerticalScroll","scrollPos","useScrollbar","onMaybeEndReached","expandedRowKeys","hoveringRowKey","lastRenderedRowIndex","isDynamic","isResetting","rowHeights","resetAfterIndex","onRowExpanded","onRowHeightChange","onRowHovered","onRowsRendered","useRow","data","depthMap","useData","bodyWidth","fixedTableHeight","mainTableHeight","leftTableWidth","rightTableWidth","headerWidth","rowsHeight","windowHeight","footerHeight","emptyStyle","rootStyle","headerHeight","useStyles","isScrolling","shallowRef","containerRef","showEmpty","computed","noData","unref","length","shared","isArray","fixedData","getRowHeight","rowIndex","estimatedRowHeight","rowHeight","rowKey","onEndReached","scrollTop","_totalHeight","clientHeight","heightUntilEnd","hScrollbarSize","watch","val","value","deep"],"sources":["../../../../../../packages/components/table-v2/src/use-table.ts"],"sourcesContent":["import { computed, ref, shallowRef, toRef, unref, watch } from 'vue'\nimport { isArray } from '@element-plus/utils'\nimport {\n  useColumns,\n  useData,\n  useRow,\n  useScrollbar,\n  useStyles,\n} from './composables'\n\nimport type { TableV2Props } from './table'\nimport type { TableGridInstance } from './table-grid'\n\nfunction useTable(props: TableV2Props) {\n  const mainTableRef = ref<TableGridInstance>()\n  const leftTableRef = ref<TableGridInstance>()\n  const rightTableRef = ref<TableGridInstance>()\n  const {\n    columns,\n    columnsStyles,\n    columnsTotalWidth,\n    fixedColumnsOnLeft,\n    fixedColumnsOnRight,\n    hasFixedColumns,\n    mainColumns,\n\n    onColumnSorted,\n  } = useColumns(props, toRef(props, 'columns'), toRef(props, 'fixed'))\n\n  const {\n    scrollTo,\n    scrollToLeft,\n    scrollToTop,\n    scrollToRow,\n    onScroll,\n    onVerticalScroll,\n    scrollPos,\n  } = useScrollbar(props, {\n    mainTableRef,\n    leftTableRef,\n    rightTableRef,\n\n    onMaybeEndReached,\n  })\n\n  const {\n    expandedRowKeys,\n    hoveringRowKey,\n    lastRenderedRowIndex,\n    isDynamic,\n    isResetting,\n    rowHeights,\n\n    resetAfterIndex,\n    onRowExpanded,\n    onRowHeightChange,\n    onRowHovered,\n    onRowsRendered,\n  } = useRow(props, {\n    mainTableRef,\n    leftTableRef,\n    rightTableRef,\n  })\n\n  const { data, depthMap } = useData(props, {\n    expandedRowKeys,\n    lastRenderedRowIndex,\n    resetAfterIndex,\n  })\n\n  const {\n    bodyWidth,\n    fixedTableHeight,\n    mainTableHeight,\n    leftTableWidth,\n    rightTableWidth,\n    headerWidth,\n    rowsHeight,\n    windowHeight,\n    footerHeight,\n    emptyStyle,\n    rootStyle,\n    headerHeight,\n  } = useStyles(props, {\n    columnsTotalWidth,\n    data,\n    fixedColumnsOnLeft,\n    fixedColumnsOnRight,\n  })\n  // state\n  const isScrolling = shallowRef(false)\n\n  // DOM/Component refs\n  const containerRef = ref()\n\n  const showEmpty = computed(() => {\n    const noData = unref(data).length === 0\n\n    return isArray(props.fixedData)\n      ? props.fixedData.length === 0 && noData\n      : noData\n  })\n\n  function getRowHeight(rowIndex: number) {\n    const { estimatedRowHeight, rowHeight, rowKey } = props\n\n    if (!estimatedRowHeight) return rowHeight\n\n    return (\n      unref(rowHeights)[unref(data)[rowIndex][rowKey]] || estimatedRowHeight\n    )\n  }\n\n  function onMaybeEndReached() {\n    const { onEndReached } = props\n    if (!onEndReached) return\n\n    const { scrollTop } = unref(scrollPos)\n\n    const _totalHeight = unref(rowsHeight)\n    const clientHeight = unref(windowHeight)\n\n    const heightUntilEnd =\n      _totalHeight - (scrollTop + clientHeight) + props.hScrollbarSize\n\n    if (\n      unref(lastRenderedRowIndex) >= 0 &&\n      _totalHeight === scrollTop + unref(mainTableHeight) - unref(headerHeight)\n    ) {\n      onEndReached(heightUntilEnd)\n    }\n  }\n\n  // events\n\n  watch(\n    () => props.expandedRowKeys,\n    (val) => (expandedRowKeys.value = val),\n    {\n      deep: true,\n    }\n  )\n\n  return {\n    // models\n    columns,\n    containerRef,\n    mainTableRef,\n    leftTableRef,\n    rightTableRef,\n    // states\n    isDynamic,\n    isResetting,\n    isScrolling,\n    hoveringRowKey,\n    hasFixedColumns,\n    // records\n    columnsStyles,\n    columnsTotalWidth,\n    data,\n    expandedRowKeys,\n    depthMap,\n    fixedColumnsOnLeft,\n    fixedColumnsOnRight,\n    mainColumns,\n    // metadata\n    bodyWidth,\n    emptyStyle,\n    rootStyle,\n    headerWidth,\n    footerHeight,\n    mainTableHeight,\n    fixedTableHeight,\n    leftTableWidth,\n    rightTableWidth,\n    // flags\n    showEmpty,\n\n    // methods\n    getRowHeight,\n\n    // event handlers\n    onColumnSorted,\n    onRowHovered,\n    onRowExpanded,\n    onRowsRendered,\n    onRowHeightChange,\n    // use scrollbars\n    scrollTo,\n    scrollToLeft,\n    scrollToTop,\n    scrollToRow,\n    onScroll,\n    onVerticalScroll,\n  }\n}\n\nexport { useTable }\n\nexport type UseTableReturn = ReturnType<typeof useTable>\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}