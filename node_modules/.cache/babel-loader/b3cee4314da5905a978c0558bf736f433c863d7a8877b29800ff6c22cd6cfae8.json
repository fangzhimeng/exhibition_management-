{"ast":null,"code":"'use strict';\n\nrequire(\"core-js/modules/es.array.push.js\");\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\nvar vue = require('vue');\nrequire('../../../../utils/index.js');\nvar util = require('../util.js');\nvar expand = require('./expand.js');\nvar current = require('./current.js');\nvar tree = require('./tree.js');\nvar shared = require('@vue/shared');\nconst sortData = (data, states) => {\n  const sortingColumn = states.sortingColumn;\n  if (!sortingColumn || typeof sortingColumn.sortable === \"string\") {\n    return data;\n  }\n  return util.orderBy(data, states.sortProp, states.sortOrder, sortingColumn.sortMethod, sortingColumn.sortBy);\n};\nconst doFlattenColumns = columns => {\n  const result = [];\n  columns.forEach(column => {\n    if (column.children && column.children.length > 0) {\n      result.push.apply(result, doFlattenColumns(column.children));\n    } else {\n      result.push(column);\n    }\n  });\n  return result;\n};\nfunction useWatcher() {\n  var _a;\n  const instance = vue.getCurrentInstance();\n  const {\n    size: tableSize\n  } = vue.toRefs((_a = instance.proxy) == null ? void 0 : _a.$props);\n  const rowKey = vue.ref(null);\n  const data = vue.ref([]);\n  const _data = vue.ref([]);\n  const isComplex = vue.ref(false);\n  const _columns = vue.ref([]);\n  const originColumns = vue.ref([]);\n  const columns = vue.ref([]);\n  const fixedColumns = vue.ref([]);\n  const rightFixedColumns = vue.ref([]);\n  const leafColumns = vue.ref([]);\n  const fixedLeafColumns = vue.ref([]);\n  const rightFixedLeafColumns = vue.ref([]);\n  const updateOrderFns = [];\n  const leafColumnsLength = vue.ref(0);\n  const fixedLeafColumnsLength = vue.ref(0);\n  const rightFixedLeafColumnsLength = vue.ref(0);\n  const isAllSelected = vue.ref(false);\n  const selection = vue.ref([]);\n  const reserveSelection = vue.ref(false);\n  const selectOnIndeterminate = vue.ref(false);\n  const selectable = vue.ref(null);\n  const filters = vue.ref({});\n  const filteredData = vue.ref(null);\n  const sortingColumn = vue.ref(null);\n  const sortProp = vue.ref(null);\n  const sortOrder = vue.ref(null);\n  const hoverRow = vue.ref(null);\n  vue.watch(data, () => instance.state && scheduleLayout(false), {\n    deep: true\n  });\n  const assertRowKey = () => {\n    if (!rowKey.value) throw new Error(\"[ElTable] prop row-key is required\");\n  };\n  const updateChildFixed = column => {\n    var _a2;\n    (_a2 = column.children) == null ? void 0 : _a2.forEach(childColumn => {\n      childColumn.fixed = column.fixed;\n      updateChildFixed(childColumn);\n    });\n  };\n  const updateColumns = () => {\n    _columns.value.forEach(column => {\n      updateChildFixed(column);\n    });\n    fixedColumns.value = _columns.value.filter(column => column.fixed === true || column.fixed === \"left\");\n    rightFixedColumns.value = _columns.value.filter(column => column.fixed === \"right\");\n    if (fixedColumns.value.length > 0 && _columns.value[0] && _columns.value[0].type === \"selection\" && !_columns.value[0].fixed) {\n      _columns.value[0].fixed = true;\n      fixedColumns.value.unshift(_columns.value[0]);\n    }\n    const notFixedColumns = _columns.value.filter(column => !column.fixed);\n    originColumns.value = [].concat(fixedColumns.value).concat(notFixedColumns).concat(rightFixedColumns.value);\n    const leafColumns2 = doFlattenColumns(notFixedColumns);\n    const fixedLeafColumns2 = doFlattenColumns(fixedColumns.value);\n    const rightFixedLeafColumns2 = doFlattenColumns(rightFixedColumns.value);\n    leafColumnsLength.value = leafColumns2.length;\n    fixedLeafColumnsLength.value = fixedLeafColumns2.length;\n    rightFixedLeafColumnsLength.value = rightFixedLeafColumns2.length;\n    columns.value = [].concat(fixedLeafColumns2).concat(leafColumns2).concat(rightFixedLeafColumns2);\n    isComplex.value = fixedColumns.value.length > 0 || rightFixedColumns.value.length > 0;\n  };\n  const scheduleLayout = (needUpdateColumns, immediate = false) => {\n    if (needUpdateColumns) {\n      updateColumns();\n    }\n    if (immediate) {\n      instance.state.doLayout();\n    } else {\n      instance.state.debouncedUpdateLayout();\n    }\n  };\n  const isSelected = row => {\n    return selection.value.includes(row);\n  };\n  const clearSelection = () => {\n    isAllSelected.value = false;\n    const oldSelection = selection.value;\n    if (oldSelection.length) {\n      selection.value = [];\n      instance.emit(\"selection-change\", []);\n    }\n  };\n  const cleanSelection = () => {\n    let deleted;\n    if (rowKey.value) {\n      deleted = [];\n      const selectedMap = util.getKeysMap(selection.value, rowKey.value);\n      const dataMap = util.getKeysMap(data.value, rowKey.value);\n      for (const key in selectedMap) {\n        if (shared.hasOwn(selectedMap, key) && !dataMap[key]) {\n          deleted.push(selectedMap[key].row);\n        }\n      }\n    } else {\n      deleted = selection.value.filter(item => !data.value.includes(item));\n    }\n    if (deleted.length) {\n      const newSelection = selection.value.filter(item => !deleted.includes(item));\n      selection.value = newSelection;\n      instance.emit(\"selection-change\", newSelection.slice());\n    }\n  };\n  const getSelectionRows = () => {\n    return (selection.value || []).slice();\n  };\n  const toggleRowSelection = (row, selected = void 0, emitChange = true) => {\n    const changed = util.toggleRowStatus(selection.value, row, selected);\n    if (changed) {\n      const newSelection = (selection.value || []).slice();\n      if (emitChange) {\n        instance.emit(\"select\", newSelection, row);\n      }\n      instance.emit(\"selection-change\", newSelection);\n    }\n  };\n  const _toggleAllSelection = () => {\n    var _a2, _b;\n    const value = selectOnIndeterminate.value ? !isAllSelected.value : !(isAllSelected.value || selection.value.length);\n    isAllSelected.value = value;\n    let selectionChanged = false;\n    let childrenCount = 0;\n    const rowKey2 = (_b = (_a2 = instance == null ? void 0 : instance.store) == null ? void 0 : _a2.states) == null ? void 0 : _b.rowKey.value;\n    data.value.forEach((row, index) => {\n      const rowIndex = index + childrenCount;\n      if (selectable.value) {\n        if (selectable.value.call(null, row, rowIndex) && util.toggleRowStatus(selection.value, row, value)) {\n          selectionChanged = true;\n        }\n      } else {\n        if (util.toggleRowStatus(selection.value, row, value)) {\n          selectionChanged = true;\n        }\n      }\n      childrenCount += getChildrenCount(util.getRowIdentity(row, rowKey2));\n    });\n    if (selectionChanged) {\n      instance.emit(\"selection-change\", selection.value ? selection.value.slice() : []);\n    }\n    instance.emit(\"select-all\", selection.value);\n  };\n  const updateSelectionByRowKey = () => {\n    const selectedMap = util.getKeysMap(selection.value, rowKey.value);\n    data.value.forEach(row => {\n      const rowId = util.getRowIdentity(row, rowKey.value);\n      const rowInfo = selectedMap[rowId];\n      if (rowInfo) {\n        selection.value[rowInfo.index] = row;\n      }\n    });\n  };\n  const updateAllSelected = () => {\n    var _a2, _b, _c;\n    if (((_a2 = data.value) == null ? void 0 : _a2.length) === 0) {\n      isAllSelected.value = false;\n      return;\n    }\n    let selectedMap;\n    if (rowKey.value) {\n      selectedMap = util.getKeysMap(selection.value, rowKey.value);\n    }\n    const isSelected2 = function (row) {\n      if (selectedMap) {\n        return !!selectedMap[util.getRowIdentity(row, rowKey.value)];\n      } else {\n        return selection.value.includes(row);\n      }\n    };\n    let isAllSelected_ = true;\n    let selectedCount = 0;\n    let childrenCount = 0;\n    for (let i = 0, j = (data.value || []).length; i < j; i++) {\n      const keyProp = (_c = (_b = instance == null ? void 0 : instance.store) == null ? void 0 : _b.states) == null ? void 0 : _c.rowKey.value;\n      const rowIndex = i + childrenCount;\n      const item = data.value[i];\n      const isRowSelectable = selectable.value && selectable.value.call(null, item, rowIndex);\n      if (!isSelected2(item)) {\n        if (!selectable.value || isRowSelectable) {\n          isAllSelected_ = false;\n          break;\n        }\n      } else {\n        selectedCount++;\n      }\n      childrenCount += getChildrenCount(util.getRowIdentity(item, keyProp));\n    }\n    if (selectedCount === 0) isAllSelected_ = false;\n    isAllSelected.value = isAllSelected_;\n  };\n  const getChildrenCount = rowKey2 => {\n    var _a2;\n    if (!instance || !instance.store) return 0;\n    const {\n      treeData\n    } = instance.store.states;\n    let count = 0;\n    const children = (_a2 = treeData.value[rowKey2]) == null ? void 0 : _a2.children;\n    if (children) {\n      count += children.length;\n      children.forEach(childKey => {\n        count += getChildrenCount(childKey);\n      });\n    }\n    return count;\n  };\n  const updateFilters = (columns2, values) => {\n    if (!Array.isArray(columns2)) {\n      columns2 = [columns2];\n    }\n    const filters_ = {};\n    columns2.forEach(col => {\n      filters.value[col.id] = values;\n      filters_[col.columnKey || col.id] = values;\n    });\n    return filters_;\n  };\n  const updateSort = (column, prop, order) => {\n    if (sortingColumn.value && sortingColumn.value !== column) {\n      sortingColumn.value.order = null;\n    }\n    sortingColumn.value = column;\n    sortProp.value = prop;\n    sortOrder.value = order;\n  };\n  const execFilter = () => {\n    let sourceData = vue.unref(_data);\n    Object.keys(filters.value).forEach(columnId => {\n      const values = filters.value[columnId];\n      if (!values || values.length === 0) return;\n      const column = util.getColumnById({\n        columns: columns.value\n      }, columnId);\n      if (column && column.filterMethod) {\n        sourceData = sourceData.filter(row => {\n          return values.some(value => column.filterMethod.call(null, value, row, column));\n        });\n      }\n    });\n    filteredData.value = sourceData;\n  };\n  const execSort = () => {\n    data.value = sortData(filteredData.value, {\n      sortingColumn: sortingColumn.value,\n      sortProp: sortProp.value,\n      sortOrder: sortOrder.value\n    });\n  };\n  const execQuery = (ignore = void 0) => {\n    if (!(ignore && ignore.filter)) {\n      execFilter();\n    }\n    execSort();\n  };\n  const clearFilter = columnKeys => {\n    const {\n      tableHeaderRef\n    } = instance.refs;\n    if (!tableHeaderRef) return;\n    const panels = Object.assign({}, tableHeaderRef.filterPanels);\n    const keys = Object.keys(panels);\n    if (!keys.length) return;\n    if (typeof columnKeys === \"string\") {\n      columnKeys = [columnKeys];\n    }\n    if (Array.isArray(columnKeys)) {\n      const columns_ = columnKeys.map(key => util.getColumnByKey({\n        columns: columns.value\n      }, key));\n      keys.forEach(key => {\n        const column = columns_.find(col => col.id === key);\n        if (column) {\n          column.filteredValue = [];\n        }\n      });\n      instance.store.commit(\"filterChange\", {\n        column: columns_,\n        values: [],\n        silent: true,\n        multi: true\n      });\n    } else {\n      keys.forEach(key => {\n        const column = columns.value.find(col => col.id === key);\n        if (column) {\n          column.filteredValue = [];\n        }\n      });\n      filters.value = {};\n      instance.store.commit(\"filterChange\", {\n        column: {},\n        values: [],\n        silent: true\n      });\n    }\n  };\n  const clearSort = () => {\n    if (!sortingColumn.value) return;\n    updateSort(null, null, null);\n    instance.store.commit(\"changeSortCondition\", {\n      silent: true\n    });\n  };\n  const {\n    setExpandRowKeys,\n    toggleRowExpansion,\n    updateExpandRows,\n    states: expandStates,\n    isRowExpanded\n  } = expand[\"default\"]({\n    data,\n    rowKey\n  });\n  const {\n    updateTreeExpandKeys,\n    toggleTreeExpansion,\n    updateTreeData,\n    loadOrToggle,\n    states: treeStates\n  } = tree[\"default\"]({\n    data,\n    rowKey\n  });\n  const {\n    updateCurrentRowData,\n    updateCurrentRow,\n    setCurrentRowKey,\n    states: currentData\n  } = current[\"default\"]({\n    data,\n    rowKey\n  });\n  const setExpandRowKeysAdapter = val => {\n    setExpandRowKeys(val);\n    updateTreeExpandKeys(val);\n  };\n  const toggleRowExpansionAdapter = (row, expanded) => {\n    const hasExpandColumn = columns.value.some(({\n      type\n    }) => type === \"expand\");\n    if (hasExpandColumn) {\n      toggleRowExpansion(row, expanded);\n    } else {\n      toggleTreeExpansion(row, expanded);\n    }\n  };\n  return {\n    assertRowKey,\n    updateColumns,\n    scheduleLayout,\n    isSelected,\n    clearSelection,\n    cleanSelection,\n    getSelectionRows,\n    toggleRowSelection,\n    _toggleAllSelection,\n    toggleAllSelection: null,\n    updateSelectionByRowKey,\n    updateAllSelected,\n    updateFilters,\n    updateCurrentRow,\n    updateSort,\n    execFilter,\n    execSort,\n    execQuery,\n    clearFilter,\n    clearSort,\n    toggleRowExpansion,\n    setExpandRowKeysAdapter,\n    setCurrentRowKey,\n    toggleRowExpansionAdapter,\n    isRowExpanded,\n    updateExpandRows,\n    updateCurrentRowData,\n    loadOrToggle,\n    updateTreeData,\n    states: {\n      tableSize,\n      rowKey,\n      data,\n      _data,\n      isComplex,\n      _columns,\n      originColumns,\n      columns,\n      fixedColumns,\n      rightFixedColumns,\n      leafColumns,\n      fixedLeafColumns,\n      rightFixedLeafColumns,\n      updateOrderFns,\n      leafColumnsLength,\n      fixedLeafColumnsLength,\n      rightFixedLeafColumnsLength,\n      isAllSelected,\n      selection,\n      reserveSelection,\n      selectOnIndeterminate,\n      selectable,\n      filters,\n      filteredData,\n      sortingColumn,\n      sortProp,\n      sortOrder,\n      hoverRow,\n      ...expandStates,\n      ...treeStates,\n      ...currentData\n    }\n  };\n}\nexports[\"default\"] = useWatcher;","map":{"version":3,"names":["sortData","data","states","sortingColumn","sortable","util","orderBy","sortProp","sortOrder","sortMethod","sortBy","doFlattenColumns","columns","result","forEach","column","children","length","push","apply","useWatcher","_a","instance","vue","getCurrentInstance","size","tableSize","toRefs","proxy","$props","rowKey","ref","_data","isComplex","_columns","originColumns","fixedColumns","rightFixedColumns","leafColumns","fixedLeafColumns","rightFixedLeafColumns","updateOrderFns","leafColumnsLength","fixedLeafColumnsLength","rightFixedLeafColumnsLength","isAllSelected","selection","reserveSelection","selectOnIndeterminate","selectable","filters","filteredData","hoverRow","watch","state","scheduleLayout","deep","assertRowKey","value","Error","updateChildFixed","_a2","childColumn","fixed","updateColumns","filter","type","unshift","notFixedColumns","concat","leafColumns2","fixedLeafColumns2","rightFixedLeafColumns2","needUpdateColumns","immediate","doLayout","debouncedUpdateLayout","isSelected","row","includes","clearSelection","oldSelection","emit","cleanSelection","deleted","selectedMap","getKeysMap","dataMap","key","shared","hasOwn","item","newSelection","slice","getSelectionRows","toggleRowSelection","selected","emitChange","changed","toggleRowStatus","_toggleAllSelection","_b","selectionChanged","childrenCount","rowKey2","store","index","rowIndex","call","getChildrenCount","getRowIdentity","updateSelectionByRowKey","rowId","rowInfo","updateAllSelected","_c","isSelected2","isAllSelected_","selectedCount","i","j","keyProp","isRowSelectable","treeData","count","childKey","updateFilters","columns2","values","Array","isArray","filters_","col","id","columnKey","updateSort","prop","order","execFilter","sourceData","unref","Object","keys","columnId","getColumnById","filterMethod","some","execSort","execQuery","ignore","clearFilter","columnKeys","tableHeaderRef","refs","panels","assign","filterPanels","columns_","map","getColumnByKey","find","filteredValue","commit","silent","multi","clearSort","setExpandRowKeys","toggleRowExpansion","updateExpandRows","expandStates","isRowExpanded","expand","updateTreeExpandKeys","toggleTreeExpansion","updateTreeData","loadOrToggle","treeStates","tree","updateCurrentRowData","updateCurrentRow","setCurrentRowKey","currentData","current","setExpandRowKeysAdapter","val","toggleRowExpansionAdapter","expanded","hasExpandColumn","toggleAllSelection"],"sources":["../../../../../../../packages/components/table/src/store/watcher.ts"],"sourcesContent":["// @ts-nocheck\nimport { getCurrentInstance, ref, toRefs, unref, watch } from 'vue'\nimport { hasOwn } from '@element-plus/utils'\nimport {\n  getColumnById,\n  getColumnByKey,\n  getKeysMap,\n  getRowIdentity,\n  orderBy,\n  toggleRowStatus,\n} from '../util'\nimport useExpand from './expand'\nimport useCurrent from './current'\nimport useTree from './tree'\n\nimport type { Ref } from 'vue'\nimport type { TableColumnCtx } from '../table-column/defaults'\nimport type { Table, TableRefs } from '../table/defaults'\nimport type { StoreFilter } from '.'\n\nconst sortData = (data, states) => {\n  const sortingColumn = states.sortingColumn\n  if (!sortingColumn || typeof sortingColumn.sortable === 'string') {\n    return data\n  }\n  return orderBy(\n    data,\n    states.sortProp,\n    states.sortOrder,\n    sortingColumn.sortMethod,\n    sortingColumn.sortBy\n  )\n}\n\nconst doFlattenColumns = (columns) => {\n  const result = []\n  columns.forEach((column) => {\n    if (column.children && column.children.length > 0) {\n      // eslint-disable-next-line prefer-spread\n      result.push.apply(result, doFlattenColumns(column.children))\n    } else {\n      result.push(column)\n    }\n  })\n  return result\n}\n\nfunction useWatcher<T>() {\n  const instance = getCurrentInstance() as Table<T>\n  const { size: tableSize } = toRefs(instance.proxy?.$props as any)\n  const rowKey: Ref<string> = ref(null)\n  const data: Ref<T[]> = ref([])\n  const _data: Ref<T[]> = ref([])\n  const isComplex = ref(false)\n  const _columns: Ref<TableColumnCtx<T>[]> = ref([])\n  const originColumns: Ref<TableColumnCtx<T>[]> = ref([])\n  const columns: Ref<TableColumnCtx<T>[]> = ref([])\n  const fixedColumns: Ref<TableColumnCtx<T>[]> = ref([])\n  const rightFixedColumns: Ref<TableColumnCtx<T>[]> = ref([])\n  const leafColumns: Ref<TableColumnCtx<T>[]> = ref([])\n  const fixedLeafColumns: Ref<TableColumnCtx<T>[]> = ref([])\n  const rightFixedLeafColumns: Ref<TableColumnCtx<T>[]> = ref([])\n  const updateOrderFns: (() => void)[] = []\n  const leafColumnsLength = ref(0)\n  const fixedLeafColumnsLength = ref(0)\n  const rightFixedLeafColumnsLength = ref(0)\n  const isAllSelected = ref(false)\n  const selection: Ref<T[]> = ref([])\n  const reserveSelection = ref(false)\n  const selectOnIndeterminate = ref(false)\n  const selectable: Ref<(row: T, index: number) => boolean> = ref(null)\n  const filters: Ref<StoreFilter> = ref({})\n  const filteredData = ref(null)\n  const sortingColumn = ref(null)\n  const sortProp = ref(null)\n  const sortOrder = ref(null)\n  const hoverRow = ref(null)\n\n  watch(data, () => instance.state && scheduleLayout(false), {\n    deep: true,\n  })\n\n  // 检查 rowKey 是否存在\n  const assertRowKey = () => {\n    if (!rowKey.value) throw new Error('[ElTable] prop row-key is required')\n  }\n\n  // 更新 fixed\n  const updateChildFixed = (column: TableColumnCtx<T>) => {\n    column.children?.forEach((childColumn) => {\n      childColumn.fixed = column.fixed\n      updateChildFixed(childColumn)\n    })\n  }\n\n  // 更新列\n  const updateColumns = () => {\n    _columns.value.forEach((column) => {\n      updateChildFixed(column)\n    })\n    fixedColumns.value = _columns.value.filter(\n      (column) => column.fixed === true || column.fixed === 'left'\n    )\n    rightFixedColumns.value = _columns.value.filter(\n      (column) => column.fixed === 'right'\n    )\n    if (\n      fixedColumns.value.length > 0 &&\n      _columns.value[0] &&\n      _columns.value[0].type === 'selection' &&\n      !_columns.value[0].fixed\n    ) {\n      _columns.value[0].fixed = true\n      fixedColumns.value.unshift(_columns.value[0])\n    }\n\n    const notFixedColumns = _columns.value.filter((column) => !column.fixed)\n    originColumns.value = []\n      .concat(fixedColumns.value)\n      .concat(notFixedColumns)\n      .concat(rightFixedColumns.value)\n    const leafColumns = doFlattenColumns(notFixedColumns)\n    const fixedLeafColumns = doFlattenColumns(fixedColumns.value)\n    const rightFixedLeafColumns = doFlattenColumns(rightFixedColumns.value)\n\n    leafColumnsLength.value = leafColumns.length\n    fixedLeafColumnsLength.value = fixedLeafColumns.length\n    rightFixedLeafColumnsLength.value = rightFixedLeafColumns.length\n\n    columns.value = []\n      .concat(fixedLeafColumns)\n      .concat(leafColumns)\n      .concat(rightFixedLeafColumns)\n    isComplex.value =\n      fixedColumns.value.length > 0 || rightFixedColumns.value.length > 0\n  }\n\n  // 更新 DOM\n  const scheduleLayout = (needUpdateColumns?: boolean, immediate = false) => {\n    if (needUpdateColumns) {\n      updateColumns()\n    }\n    if (immediate) {\n      instance.state.doLayout()\n    } else {\n      instance.state.debouncedUpdateLayout()\n    }\n  }\n\n  // 选择\n  const isSelected = (row) => {\n    return selection.value.includes(row)\n  }\n\n  const clearSelection = () => {\n    isAllSelected.value = false\n    const oldSelection = selection.value\n    if (oldSelection.length) {\n      selection.value = []\n      instance.emit('selection-change', [])\n    }\n  }\n\n  const cleanSelection = () => {\n    let deleted\n    if (rowKey.value) {\n      deleted = []\n      const selectedMap = getKeysMap(selection.value, rowKey.value)\n      const dataMap = getKeysMap(data.value, rowKey.value)\n      for (const key in selectedMap) {\n        if (hasOwn(selectedMap, key) && !dataMap[key]) {\n          deleted.push(selectedMap[key].row)\n        }\n      }\n    } else {\n      deleted = selection.value.filter((item) => !data.value.includes(item))\n    }\n    if (deleted.length) {\n      const newSelection = selection.value.filter(\n        (item) => !deleted.includes(item)\n      )\n      selection.value = newSelection\n      instance.emit('selection-change', newSelection.slice())\n    }\n  }\n\n  const getSelectionRows = () => {\n    return (selection.value || []).slice()\n  }\n\n  const toggleRowSelection = (\n    row: T,\n    selected = undefined,\n    emitChange = true\n  ) => {\n    const changed = toggleRowStatus(selection.value, row, selected)\n    if (changed) {\n      const newSelection = (selection.value || []).slice()\n      // 调用 API 修改选中值，不触发 select 事件\n      if (emitChange) {\n        instance.emit('select', newSelection, row)\n      }\n      instance.emit('selection-change', newSelection)\n    }\n  }\n\n  const _toggleAllSelection = () => {\n    // when only some rows are selected (but not all), select or deselect all of them\n    // depending on the value of selectOnIndeterminate\n    const value = selectOnIndeterminate.value\n      ? !isAllSelected.value\n      : !(isAllSelected.value || selection.value.length)\n    isAllSelected.value = value\n\n    let selectionChanged = false\n    let childrenCount = 0\n    const rowKey = instance?.store?.states?.rowKey.value\n    data.value.forEach((row, index) => {\n      const rowIndex = index + childrenCount\n      if (selectable.value) {\n        if (\n          selectable.value.call(null, row, rowIndex) &&\n          toggleRowStatus(selection.value, row, value)\n        ) {\n          selectionChanged = true\n        }\n      } else {\n        if (toggleRowStatus(selection.value, row, value)) {\n          selectionChanged = true\n        }\n      }\n      childrenCount += getChildrenCount(getRowIdentity(row, rowKey))\n    })\n\n    if (selectionChanged) {\n      instance.emit(\n        'selection-change',\n        selection.value ? selection.value.slice() : []\n      )\n    }\n    instance.emit('select-all', selection.value)\n  }\n\n  const updateSelectionByRowKey = () => {\n    const selectedMap = getKeysMap(selection.value, rowKey.value)\n    data.value.forEach((row) => {\n      const rowId = getRowIdentity(row, rowKey.value)\n      const rowInfo = selectedMap[rowId]\n      if (rowInfo) {\n        selection.value[rowInfo.index] = row\n      }\n    })\n  }\n\n  const updateAllSelected = () => {\n    // data 为 null 时，解构时的默认值会被忽略\n    if (data.value?.length === 0) {\n      isAllSelected.value = false\n      return\n    }\n\n    let selectedMap\n    if (rowKey.value) {\n      selectedMap = getKeysMap(selection.value, rowKey.value)\n    }\n    const isSelected = function (row) {\n      if (selectedMap) {\n        return !!selectedMap[getRowIdentity(row, rowKey.value)]\n      } else {\n        return selection.value.includes(row)\n      }\n    }\n    let isAllSelected_ = true\n    let selectedCount = 0\n    let childrenCount = 0\n    for (let i = 0, j = (data.value || []).length; i < j; i++) {\n      const keyProp = instance?.store?.states?.rowKey.value\n      const rowIndex = i + childrenCount\n      const item = data.value[i]\n      const isRowSelectable =\n        selectable.value && selectable.value.call(null, item, rowIndex)\n      if (!isSelected(item)) {\n        if (!selectable.value || isRowSelectable) {\n          isAllSelected_ = false\n          break\n        }\n      } else {\n        selectedCount++\n      }\n      childrenCount += getChildrenCount(getRowIdentity(item, keyProp))\n    }\n\n    if (selectedCount === 0) isAllSelected_ = false\n    isAllSelected.value = isAllSelected_\n  }\n\n  // gets the number of all child nodes by rowKey\n  const getChildrenCount = (rowKey: string) => {\n    if (!instance || !instance.store) return 0\n    const { treeData } = instance.store.states\n    let count = 0\n    const children = treeData.value[rowKey]?.children\n    if (children) {\n      count += children.length\n      children.forEach((childKey) => {\n        count += getChildrenCount(childKey)\n      })\n    }\n    return count\n  }\n\n  // 过滤与排序\n  const updateFilters = (columns, values) => {\n    if (!Array.isArray(columns)) {\n      columns = [columns]\n    }\n    const filters_ = {}\n    columns.forEach((col) => {\n      filters.value[col.id] = values\n      filters_[col.columnKey || col.id] = values\n    })\n    return filters_\n  }\n\n  const updateSort = (column, prop, order) => {\n    if (sortingColumn.value && sortingColumn.value !== column) {\n      sortingColumn.value.order = null\n    }\n    sortingColumn.value = column\n    sortProp.value = prop\n    sortOrder.value = order\n  }\n\n  const execFilter = () => {\n    let sourceData = unref(_data)\n    Object.keys(filters.value).forEach((columnId) => {\n      const values = filters.value[columnId]\n      if (!values || values.length === 0) return\n      const column = getColumnById(\n        {\n          columns: columns.value,\n        },\n        columnId\n      )\n      if (column && column.filterMethod) {\n        sourceData = sourceData.filter((row) => {\n          return values.some((value) =>\n            column.filterMethod.call(null, value, row, column)\n          )\n        })\n      }\n    })\n\n    filteredData.value = sourceData\n  }\n\n  const execSort = () => {\n    data.value = sortData(filteredData.value, {\n      sortingColumn: sortingColumn.value,\n      sortProp: sortProp.value,\n      sortOrder: sortOrder.value,\n    })\n  }\n\n  // 根据 filters 与 sort 去过滤 data\n  const execQuery = (ignore = undefined) => {\n    if (!(ignore && ignore.filter)) {\n      execFilter()\n    }\n    execSort()\n  }\n\n  const clearFilter = (columnKeys) => {\n    const { tableHeaderRef } = instance.refs as TableRefs\n    if (!tableHeaderRef) return\n    const panels = Object.assign({}, tableHeaderRef.filterPanels)\n\n    const keys = Object.keys(panels)\n    if (!keys.length) return\n\n    if (typeof columnKeys === 'string') {\n      columnKeys = [columnKeys]\n    }\n\n    if (Array.isArray(columnKeys)) {\n      const columns_ = columnKeys.map((key) =>\n        getColumnByKey(\n          {\n            columns: columns.value,\n          },\n          key\n        )\n      )\n      keys.forEach((key) => {\n        const column = columns_.find((col) => col.id === key)\n        if (column) {\n          column.filteredValue = []\n        }\n      })\n      instance.store.commit('filterChange', {\n        column: columns_,\n        values: [],\n        silent: true,\n        multi: true,\n      })\n    } else {\n      keys.forEach((key) => {\n        const column = columns.value.find((col) => col.id === key)\n        if (column) {\n          column.filteredValue = []\n        }\n      })\n\n      filters.value = {}\n      instance.store.commit('filterChange', {\n        column: {},\n        values: [],\n        silent: true,\n      })\n    }\n  }\n\n  const clearSort = () => {\n    if (!sortingColumn.value) return\n\n    updateSort(null, null, null)\n    instance.store.commit('changeSortCondition', {\n      silent: true,\n    })\n  }\n  const {\n    setExpandRowKeys,\n    toggleRowExpansion,\n    updateExpandRows,\n    states: expandStates,\n    isRowExpanded,\n  } = useExpand({\n    data,\n    rowKey,\n  })\n  const {\n    updateTreeExpandKeys,\n    toggleTreeExpansion,\n    updateTreeData,\n    loadOrToggle,\n    states: treeStates,\n  } = useTree({\n    data,\n    rowKey,\n  })\n  const {\n    updateCurrentRowData,\n    updateCurrentRow,\n    setCurrentRowKey,\n    states: currentData,\n  } = useCurrent({\n    data,\n    rowKey,\n  })\n  // 适配层，expand-row-keys 在 Expand 与 TreeTable 中都有使用\n  const setExpandRowKeysAdapter = (val: string[]) => {\n    // 这里会触发额外的计算，但为了兼容性，暂时这么做\n    setExpandRowKeys(val)\n    updateTreeExpandKeys(val)\n  }\n\n  // 展开行与 TreeTable 都要使用\n  const toggleRowExpansionAdapter = (row: T, expanded?: boolean) => {\n    const hasExpandColumn = columns.value.some(({ type }) => type === 'expand')\n    if (hasExpandColumn) {\n      toggleRowExpansion(row, expanded)\n    } else {\n      toggleTreeExpansion(row, expanded)\n    }\n  }\n\n  return {\n    assertRowKey,\n    updateColumns,\n    scheduleLayout,\n    isSelected,\n    clearSelection,\n    cleanSelection,\n    getSelectionRows,\n    toggleRowSelection,\n    _toggleAllSelection,\n    toggleAllSelection: null,\n    updateSelectionByRowKey,\n    updateAllSelected,\n    updateFilters,\n    updateCurrentRow,\n    updateSort,\n    execFilter,\n    execSort,\n    execQuery,\n    clearFilter,\n    clearSort,\n    toggleRowExpansion,\n    setExpandRowKeysAdapter,\n    setCurrentRowKey,\n    toggleRowExpansionAdapter,\n    isRowExpanded,\n    updateExpandRows,\n    updateCurrentRowData,\n    loadOrToggle,\n    updateTreeData,\n    states: {\n      tableSize,\n      rowKey,\n      data,\n      _data,\n      isComplex,\n      _columns,\n      originColumns,\n      columns,\n      fixedColumns,\n      rightFixedColumns,\n      leafColumns,\n      fixedLeafColumns,\n      rightFixedLeafColumns,\n      updateOrderFns,\n      leafColumnsLength,\n      fixedLeafColumnsLength,\n      rightFixedLeafColumnsLength,\n      isAllSelected,\n      selection,\n      reserveSelection,\n      selectOnIndeterminate,\n      selectable,\n      filters,\n      filteredData,\n      sortingColumn,\n      sortProp,\n      sortOrder,\n      hoverRow,\n      ...expandStates,\n      ...treeStates,\n      ...currentData,\n    },\n  }\n}\n\nexport default useWatcher\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}