{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\nvar vue = require('vue');\nvar lodashUnified = require('lodash-unified');\nrequire('../../../utils/index.js');\nvar token = require('./token.js');\nvar shared = require('@vue/shared');\nvar strings = require('../../../utils/strings.js');\nfunction useOption(props, states) {\n  const select = vue.inject(token.selectKey);\n  const selectGroup = vue.inject(token.selectGroupKey, {\n    disabled: false\n  });\n  const isObject = vue.computed(() => shared.isObject(props.value));\n  const itemSelected = vue.computed(() => {\n    if (!select.props.multiple) {\n      return isEqual(props.value, select.props.modelValue);\n    } else {\n      return contains(select.props.modelValue, props.value);\n    }\n  });\n  const limitReached = vue.computed(() => {\n    if (select.props.multiple) {\n      const modelValue = select.props.modelValue || [];\n      return !itemSelected.value && modelValue.length >= select.props.multipleLimit && select.props.multipleLimit > 0;\n    } else {\n      return false;\n    }\n  });\n  const currentLabel = vue.computed(() => {\n    return props.label || (isObject.value ? \"\" : props.value);\n  });\n  const currentValue = vue.computed(() => {\n    return props.value || props.label || \"\";\n  });\n  const isDisabled = vue.computed(() => {\n    return props.disabled || states.groupDisabled || limitReached.value;\n  });\n  const instance = vue.getCurrentInstance();\n  const contains = (arr = [], target) => {\n    if (!isObject.value) {\n      return arr && arr.includes(target);\n    } else {\n      const valueKey = select.props.valueKey;\n      return arr && arr.some(item => {\n        return vue.toRaw(lodashUnified.get(item, valueKey)) === lodashUnified.get(target, valueKey);\n      });\n    }\n  };\n  const isEqual = (a, b) => {\n    if (!isObject.value) {\n      return a === b;\n    } else {\n      const {\n        valueKey\n      } = select.props;\n      return lodashUnified.get(a, valueKey) === lodashUnified.get(b, valueKey);\n    }\n  };\n  const hoverItem = () => {\n    if (!props.disabled && !selectGroup.disabled) {\n      select.hoverIndex = select.optionsArray.indexOf(instance.proxy);\n    }\n  };\n  vue.watch(() => currentLabel.value, () => {\n    if (!props.created && !select.props.remote) select.setSelected();\n  });\n  vue.watch(() => props.value, (val, oldVal) => {\n    const {\n      remote,\n      valueKey\n    } = select.props;\n    if (!Object.is(val, oldVal)) {\n      select.onOptionDestroy(oldVal, instance.proxy);\n      select.onOptionCreate(instance.proxy);\n    }\n    if (!props.created && !remote) {\n      if (valueKey && shared.isObject(val) && shared.isObject(oldVal) && val[valueKey] === oldVal[valueKey]) {\n        return;\n      }\n      select.setSelected();\n    }\n  });\n  vue.watch(() => selectGroup.disabled, () => {\n    states.groupDisabled = selectGroup.disabled;\n  }, {\n    immediate: true\n  });\n  const {\n    queryChange\n  } = vue.toRaw(select);\n  vue.watch(queryChange, changes => {\n    const {\n      query\n    } = vue.unref(changes);\n    const regexp = new RegExp(strings.escapeStringRegexp(query), \"i\");\n    states.visible = regexp.test(currentLabel.value) || props.created;\n    if (!states.visible) {\n      select.filteredOptionsCount--;\n    }\n  }, {\n    immediate: true\n  });\n  return {\n    select,\n    currentLabel,\n    currentValue,\n    itemSelected,\n    isDisabled,\n    hoverItem\n  };\n}\nexports.useOption = useOption;","map":{"version":3,"names":["useOption","props","states","select","vue","inject","token","selectKey","selectGroup","selectGroupKey","disabled","isObject","computed","shared","value","itemSelected","multiple","isEqual","modelValue","contains","limitReached","length","multipleLimit","currentLabel","label","currentValue","isDisabled","groupDisabled","instance","getCurrentInstance","arr","target","includes","valueKey","some","item","toRaw","lodashUnified","get","a","b","hoverItem","hoverIndex","optionsArray","indexOf","proxy","watch","created","remote","setSelected","val","oldVal","Object","is","onOptionDestroy","onOptionCreate","immediate","queryChange","changes","query","unref","regexp","RegExp","strings","escapeStringRegexp","visible","test","filteredOptionsCount"],"sources":["../../../../../../packages/components/select/src/useOption.ts"],"sourcesContent":["// @ts-nocheck\nimport { computed, getCurrentInstance, inject, toRaw, unref, watch } from 'vue'\nimport { get } from 'lodash-unified'\nimport { isObject as _isObject, escapeStringRegexp } from '@element-plus/utils'\nimport { selectGroupKey, selectKey } from './token'\n\nimport type { Ref } from 'vue'\nimport type { QueryChangeCtx } from './token'\n\nexport function useOption(props, states) {\n  // inject\n  const select = inject(selectKey)\n  const selectGroup = inject(selectGroupKey, { disabled: false })\n\n  // computed\n  const isObject = computed(() => _isObject(props.value))\n\n  const itemSelected = computed(() => {\n    if (!select.props.multiple) {\n      return isEqual(props.value, select.props.modelValue)\n    } else {\n      return contains(select.props.modelValue as unknown[], props.value)\n    }\n  })\n\n  const limitReached = computed(() => {\n    if (select.props.multiple) {\n      const modelValue = (select.props.modelValue || []) as unknown[]\n      return (\n        !itemSelected.value &&\n        modelValue.length >= select.props.multipleLimit &&\n        select.props.multipleLimit > 0\n      )\n    } else {\n      return false\n    }\n  })\n\n  const currentLabel = computed(() => {\n    return props.label || (isObject.value ? '' : props.value)\n  })\n\n  const currentValue = computed(() => {\n    return props.value || props.label || ''\n  })\n\n  const isDisabled = computed(() => {\n    return props.disabled || states.groupDisabled || limitReached.value\n  })\n\n  const instance = getCurrentInstance()\n\n  const contains = (arr = [], target) => {\n    if (!isObject.value) {\n      return arr && arr.includes(target)\n    } else {\n      const valueKey = select.props.valueKey\n      return (\n        arr &&\n        arr.some((item) => {\n          return toRaw(get(item, valueKey)) === get(target, valueKey)\n        })\n      )\n    }\n  }\n\n  const isEqual = (a: unknown, b: unknown) => {\n    if (!isObject.value) {\n      return a === b\n    } else {\n      const { valueKey } = select.props\n      return get(a, valueKey) === get(b, valueKey)\n    }\n  }\n\n  const hoverItem = () => {\n    if (!props.disabled && !selectGroup.disabled) {\n      select.hoverIndex = select.optionsArray.indexOf(instance.proxy)\n    }\n  }\n\n  watch(\n    () => currentLabel.value,\n    () => {\n      if (!props.created && !select.props.remote) select.setSelected()\n    }\n  )\n\n  watch(\n    () => props.value,\n    (val, oldVal) => {\n      const { remote, valueKey } = select.props\n\n      if (!Object.is(val, oldVal)) {\n        select.onOptionDestroy(oldVal, instance.proxy)\n        select.onOptionCreate(instance.proxy)\n      }\n\n      if (!props.created && !remote) {\n        if (\n          valueKey &&\n          _isObject(val) &&\n          _isObject(oldVal) &&\n          val[valueKey] === oldVal[valueKey]\n        ) {\n          return\n        }\n        select.setSelected()\n      }\n    }\n  )\n\n  watch(\n    () => selectGroup.disabled,\n    () => {\n      states.groupDisabled = selectGroup.disabled\n    },\n    { immediate: true }\n  )\n\n  const { queryChange } = toRaw(select)\n  watch(\n    queryChange,\n    (changes: Ref<QueryChangeCtx>) => {\n      const { query } = unref(changes)\n\n      const regexp = new RegExp(escapeStringRegexp(query), 'i')\n      states.visible = regexp.test(currentLabel.value) || props.created\n      if (!states.visible) {\n        select.filteredOptionsCount--\n      }\n    },\n    { immediate: true }\n  )\n\n  return {\n    select,\n    currentLabel,\n    currentValue,\n    itemSelected,\n    isDisabled,\n    hoverItem,\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}